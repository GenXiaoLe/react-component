{"ast":null,"code":"var _jsxFileName = \"/Users/hanyue/development/github/react-components/src/plugins/Form.js\";\nimport React, { Component } from 'react';\n\nconst kFormCeater = Comp => {\n  var _temp;\n\n  return _temp = class Form extends Component {\n    constructor(props) {\n      super(props);\n\n      this.handleChange = e => {\n        let {\n          name,\n          value\n        } = e.target;\n        this.validateInit({ ...this.state,\n          [name]: value\n        }); // this.setState({ [name]: value }, () => {\n        //     const error = this.validateInit();\n        //     this.setState({ error })\n        // });\n      };\n\n      this.getFieldDecorator = (field, options) => InputComp => {\n        this.options[field] = options;\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 27\n          },\n          __self: this\n        }, React.cloneElement(InputComp, {\n          name: field,\n          value: this.state[field] || '',\n          onChange: this.handleChange\n        }), this.state.error[field] && React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 36\n          },\n          __self: this\n        }, this.state.error[field]));\n      };\n\n      this.getFieldValue = field => {\n        return this.state[field];\n      };\n\n      this.getFieldValues = () => {\n        return { ...this.state\n        };\n      };\n\n      this.validateInit = state => {\n        // 设置错误信息\n        const error = {}; // 配置验证表\n\n        const dict = {\n          required: _name => !this.state[_name] || this.state[_name] === '',\n          type: (_name, _type) => !this.state[_name] || typeof this.state[_name] !== _type\n        }; //接收一个callback，校验结束后返回error和value\n\n        for (let name in this.options) {\n          let _rules = this.options[name].rules;\n\n          if (name && _rules) {\n            for (let item in _rules) {\n              if (_rules[item] && dict[item] && dict[item](name, _rules[item])) {\n                error[name] = this.options[name].rules.message;\n              }\n            }\n          }\n        }\n\n        console.log(state);\n        this.setState({ ...state,\n          error\n        });\n      };\n\n      this.validateFields = validateCallback => {\n        this.validateInit(this.state);\n        validateCallback(this.state.error, { ...this.state\n        });\n      };\n\n      this.state = {\n        error: {}\n      };\n      this.options = {};\n    }\n\n    render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      }, React.createElement(Comp, {\n        getFieldDecorator: this.getFieldDecorator,\n        getFieldValue: this.getFieldValue,\n        getFieldValues: this.getFieldValues,\n        validateFields: this.validateFields,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84\n        },\n        __self: this\n      }));\n    }\n\n  }, _temp;\n};\n\nexport default kFormCeater;","map":{"version":3,"sources":["/Users/hanyue/development/github/react-components/src/plugins/Form.js"],"names":["React","Component","kFormCeater","Comp","Form","constructor","props","handleChange","e","name","value","target","validateInit","state","getFieldDecorator","field","options","InputComp","cloneElement","onChange","error","getFieldValue","getFieldValues","dict","required","_name","type","_type","_rules","rules","item","message","console","log","setState","validateFields","validateCallback","render"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;;AAEA,MAAMC,WAAW,GAAGC,IAAI,IAAI;AAAA;;AACxB,iBAAO,MAAMC,IAAN,SAAmBH,SAAnB,CAA6B;AAChCI,IAAAA,WAAW,CAACC,KAAD,EAAQ;AACf,YAAMA,KAAN;;AADe,WAOnBC,YAPmB,GAOHC,CAAD,IAAO;AAClB,YAAI;AAAEC,UAAAA,IAAF;AAAQC,UAAAA;AAAR,YAAkBF,CAAC,CAACG,MAAxB;AACA,aAAKC,YAAL,CAAkB,EACd,GAAG,KAAKC,KADM;AAEd,WAACJ,IAAD,GAAQC;AAFM,SAAlB,EAFkB,CAOlB;AACA;AACA;AACA;AACH,OAlBkB;;AAAA,WAoBnBI,iBApBmB,GAoBC,CAACC,KAAD,EAAQC,OAAR,KAAoBC,SAAS,IAAI;AACjD,aAAKD,OAAL,CAAaD,KAAb,IAAsBC,OAAtB;AACA,eAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAEChB,KAAK,CAACkB,YAAN,CAAmBD,SAAnB,EAA8B;AAC1BR,UAAAA,IAAI,EAAEM,KADoB;AAE1BL,UAAAA,KAAK,EAAE,KAAKG,KAAL,CAAWE,KAAX,KAAqB,EAFF;AAG1BI,UAAAA,QAAQ,EAAE,KAAKZ;AAHW,SAA9B,CAFD,EASC,KAAKM,KAAL,CAAWO,KAAX,CAAiBL,KAAjB,KAA2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAI,KAAKF,KAAL,CAAWO,KAAX,CAAiBL,KAAjB,CAAJ,CAT5B,CAAP;AAYH,OAlCkB;;AAAA,WAoCnBM,aApCmB,GAoCFN,KAAD,IAAW;AACvB,eAAO,KAAKF,KAAL,CAAWE,KAAX,CAAP;AACH,OAtCkB;;AAAA,WAwCnBO,cAxCmB,GAwCF,MAAM;AACnB,eAAO,EAAC,GAAG,KAAKT;AAAT,SAAP;AACH,OA1CkB;;AAAA,WA2CnBD,YA3CmB,GA2CHC,KAAD,IAAW;AACtB;AACA,cAAMO,KAAK,GAAG,EAAd,CAFsB,CAGtB;;AACA,cAAMG,IAAI,GAAG;AACTC,UAAAA,QAAQ,EAAGC,KAAD,IAAW,CAAC,KAAKZ,KAAL,CAAWY,KAAX,CAAD,IAAsB,KAAKZ,KAAL,CAAWY,KAAX,MAAsB,EADxD;AAETC,UAAAA,IAAI,EAAE,CAACD,KAAD,EAAQE,KAAR,KAAkB,CAAC,KAAKd,KAAL,CAAWY,KAAX,CAAD,IAAsB,OAAO,KAAKZ,KAAL,CAAWY,KAAX,CAAP,KAA6BE;AAFlE,SAAb,CAJsB,CAStB;;AACA,aAAK,IAAIlB,IAAT,IAAiB,KAAKO,OAAtB,EAA+B;AAC3B,cAAIY,MAAM,GAAG,KAAKZ,OAAL,CAAaP,IAAb,EAAmBoB,KAAhC;;AACA,cAAIpB,IAAI,IAAImB,MAAZ,EAAoB;AAChB,iBAAK,IAAIE,IAAT,IAAiBF,MAAjB,EAAyB;AACrB,kBAAIA,MAAM,CAACE,IAAD,CAAN,IAAgBP,IAAI,CAACO,IAAD,CAApB,IAA8BP,IAAI,CAACO,IAAD,CAAJ,CAAWrB,IAAX,EAAiBmB,MAAM,CAACE,IAAD,CAAvB,CAAlC,EAAkE;AAC9DV,gBAAAA,KAAK,CAACX,IAAD,CAAL,GAAc,KAAKO,OAAL,CAAaP,IAAb,EAAmBoB,KAAnB,CAAyBE,OAAvC;AACH;AACJ;AACJ;AACJ;;AACDC,QAAAA,OAAO,CAACC,GAAR,CAAYpB,KAAZ;AAEA,aAAKqB,QAAL,CAAc,EACV,GAAGrB,KADO;AAEVO,UAAAA;AAFU,SAAd;AAIH,OArEkB;;AAAA,WAuEnBe,cAvEmB,GAuEDC,gBAAD,IAAsB;AACnC,aAAKxB,YAAL,CAAkB,KAAKC,KAAvB;AACAuB,QAAAA,gBAAgB,CAAC,KAAKvB,KAAL,CAAWO,KAAZ,EAAmB,EAAC,GAAG,KAAKP;AAAT,SAAnB,CAAhB;AACH,OA1EkB;;AAEf,WAAKA,KAAL,GAAa;AACTO,QAAAA,KAAK,EAAE;AADE,OAAb;AAGA,WAAKJ,OAAL,GAAe,EAAf;AACH;;AAsEDqB,IAAAA,MAAM,GAAG;AACL,aACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD;AAAM,QAAA,iBAAiB,EAAE,KAAKvB,iBAA9B;AAAiD,QAAA,aAAa,EAAE,KAAKO,aAArE;AAAoF,QAAA,cAAc,EAAE,KAAKC,cAAzG;AAAyH,QAAA,cAAc,EAAE,KAAKa,cAA9I;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CADJ;AAKH;;AAnF+B,GAApC;AAqFH,CAtFD;;AAwFA,eAAejC,WAAf","sourcesContent":["import React, { Component } from 'react';\n\nconst kFormCeater = Comp => {\n    return class Form extends Component {\n        constructor(props) {\n            super(props);\n            this.state = {\n                error: {}\n            };\n            this.options = {};\n        }\n        handleChange = (e) => {\n            let { name, value } = e.target;\n            this.validateInit({\n                ...this.state,\n                [name]: value\n            });\n\n            // this.setState({ [name]: value }, () => {\n            //     const error = this.validateInit();\n            //     this.setState({ error })\n            // });\n        }\n        // 获取传入组件并绑定相应事件\n        getFieldDecorator = (field, options) => InputComp => {\n            this.options[field] = options;\n            return <div>\n                {\n                    React.cloneElement(InputComp, {\n                        name: field,\n                        value: this.state[field] || '',\n                        onChange: this.handleChange\n                    })\n                }\n                {\n                    this.state.error[field] && <p>{this.state.error[field]}</p>\n                }\n            </div>;\n        }\n        // 获取单个value\n        getFieldValue = (field) => {\n            return this.state[field];\n        }\n        // 获取所有value\n        getFieldValues = () => {\n            return {...this.state};\n        }\n        validateInit = (state) => {\n            // 设置错误信息\n            const error = {};\n            // 配置验证表\n            const dict = {\n                required: (_name) => !this.state[_name] || this.state[_name] === '',\n                type: (_name, _type) => !this.state[_name] || typeof this.state[_name] !== _type\n            }\n\n            //接收一个callback，校验结束后返回error和value\n            for (let name in this.options) {\n                let _rules = this.options[name].rules;\n                if (name && _rules) {\n                    for (let item in _rules) {\n                        if (_rules[item] && dict[item] && dict[item](name, _rules[item])) {\n                            error[name] = this.options[name].rules.message;\n                        }\n                    }\n                }\n            }\n            console.log(state);\n\n            this.setState({ \n                ...state,\n                error \n            });\n        }\n        // 数据校验\n        validateFields = (validateCallback) => {\n            this.validateInit(this.state);\n            validateCallback(this.state.error, {...this.state});\n        }\n\n        render() {\n            return (\n                <div>\n                    <Comp getFieldDecorator={this.getFieldDecorator} getFieldValue={this.getFieldValue} getFieldValues={this.getFieldValues} validateFields={this.validateFields} />\n                </div>\n            )\n        }\n    } \n}\n\nexport default kFormCeater;"]},"metadata":{},"sourceType":"module"}