{"ast":null,"code":"var _jsxFileName = \"/Users/hanyue/development/github/react-components/src/plugins/KRouter.js\";\n// 组件目标\n// 实现BrowserRouter\n// 1.将children传出\n// 2.link需要动态更新history，利用上下文context传出\n// 实现Route\n// 1. 接收两个参数 path 和 component\n// 2. 利用上下文接收history并动态更新组件\n// 3. 利用函数生成match，匹配到的话，拼装location，mactch，context，传入并根据类型生成组件\n// 4. 根据优先级children component render\n// 实现Link\n// 1.返回一个a标签 接收 to 和 children两个参数\n// 2.为了避免a标签切换界面闪屏，点击时候利用history跳转\n// 3.为了保证动态更新和一致性，使用同一个history，从父组件BrowserRouter中传下来\n// 实现switch\n// 实现Redirect \nimport React, { Component } from 'react';\nimport { createBrowserHistory } from 'history';\nimport matchPath from './matchPath';\nconst RouterContext = React.createContext();\n\nclass BrowserRouter extends Component {\n  constructor(props) {\n    super(props);\n    this.history = createBrowserHistory();\n    this.state = {\n      location: this.history.location\n    }; // 当history变化时候监听并改变\n\n    this.unListen = this.history.listen(location => {\n      this.setState({\n        location\n      });\n    });\n  }\n\n  componentWillUnmount() {\n    if (this.unListen) {\n      this.unListen();\n    }\n  }\n\n  render() {\n    return React.createElement(RouterContext.Provider, {\n      value: {\n        history: this.history,\n        location: this.state.location\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 46\n      },\n      __self: this\n    }, this.props.children);\n  }\n\n}\n\nclass Route extends Component {\n  render() {\n    return React.createElement(RouterContext.Consumer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 56\n      },\n      __self: this\n    }, context => {\n      const {\n        children,\n        component,\n        render\n      } = this.props; // props中的location优先级更高\n\n      const location = this.props.location || context.location;\n      const match = matchPath(location.pathname, this.props);\n      const props = { ...context,\n        location,\n        match\n      };\n      console.log('match', match);\n      return match ? children ? typeof children === 'function' ? children(props) : children : component ? React.createElement(component, props) : render ? render(props) : null : typeof children === 'function' ? children(props) : null;\n    });\n  }\n\n}\n\nclass Link extends Component {\n  constructor(...args) {\n    super(...args);\n\n    this.handleClick = (event, history) => {\n      event.preventDefault();\n      history.push(this.props.to);\n    };\n  }\n\n  render() {\n    const {\n      to,\n      children\n    } = this.props;\n    return React.createElement(RouterContext.Consumer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, context => {\n      return React.createElement(\"a\", {\n        href: to,\n        onClick: event => this.handleClick(event, context.history),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 90\n        },\n        __self: this\n      }, children);\n    });\n  }\n\n}\n\nexport { BrowserRouter, Route, Link };","map":{"version":3,"sources":["/Users/hanyue/development/github/react-components/src/plugins/KRouter.js"],"names":["React","Component","createBrowserHistory","matchPath","RouterContext","createContext","BrowserRouter","constructor","props","history","state","location","unListen","listen","setState","componentWillUnmount","render","children","Route","context","component","match","pathname","console","log","createElement","Link","handleClick","event","preventDefault","push","to"],"mappings":"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","sourcesContent":["// 组件目标\n// 实现BrowserRouter\n// 1.将children传出\n// 2.link需要动态更新history，利用上下文context传出\n// 实现Route\n// 1. 接收两个参数 path 和 component\n// 2. 利用上下文接收history并动态更新组件\n// 3. 利用函数生成match，匹配到的话，拼装location，mactch，context，传入并根据类型生成组件\n// 4. 根据优先级children component render\n// 实现Link\n// 1.返回一个a标签 接收 to 和 children两个参数\n// 2.为了避免a标签切换界面闪屏，点击时候利用history跳转\n// 3.为了保证动态更新和一致性，使用同一个history，从父组件BrowserRouter中传下来\n// 实现switch\n// 实现Redirect \n\nimport React, { Component } from 'react';\nimport { createBrowserHistory } from 'history';\nimport matchPath from './matchPath';\n\nconst RouterContext = React.createContext();\n\nclass BrowserRouter extends Component {\n    constructor(props) {\n        super(props);\n        this.history = createBrowserHistory();\n        this.state = {\n            location: this.history.location\n        };\n        // 当history变化时候监听并改变\n        this.unListen = this.history.listen( location => {\n            this.setState({\n                location\n            })\n        });\n    }\n\n    componentWillUnmount() {\n        if (this.unListen) {\n            this.unListen();\n        }\n    }\n\n    render() {\n        return (\n            <RouterContext.Provider value={{history: this.history, location: this.state.location}}>\n                {this.props.children}\n            </RouterContext.Provider>\n        )\n    }\n}\n\nclass Route extends Component {\n    render() {\n        return (\n            <RouterContext.Consumer>{\n                context => {\n                    const { children, component, render } = this.props;\n                    // props中的location优先级更高\n                    const location = this.props.location || context.location;\n                    const match = matchPath(location.pathname, this.props);\n                    const props = {\n                        ...context,\n                        location,\n                        match\n                    };\n                    console.log('match', match);\n                    return match ? \n                    children ? typeof children === 'function' ? children(props) : children\n                    : component ? React.createElement(component, props)\n                    : render ? render(props) : null\n                    : typeof children === 'function' ? children(props) : null\n                }\n            }</RouterContext.Consumer>\n        )\n    }\n}\n\nclass Link extends Component {\n    handleClick = (event, history) => {\n        event.preventDefault();\n        history.push(this.props.to);\n    }\n\n    render() {\n        const { to, children } = this.props;\n        return (\n            <RouterContext.Consumer>{\n                context => {\n                    return <a href={to} onClick={(event) => this.handleClick(event, context.history)}>{children}</a>\n                }    \n            }</RouterContext.Consumer>\n        )\n    }\n}\n\nexport { BrowserRouter, Route, Link };"]},"metadata":{},"sourceType":"module"}